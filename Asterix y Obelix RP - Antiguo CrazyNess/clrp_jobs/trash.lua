local buckets = {{x = -689.040, y = -670.422, z = 29.931}, {x = -756.004, y = -634.702, z = 29.271}, {x = -791.571, y = -673.676, z = 27.930}, {x = -852.450, y = -636.692, z = 27.207}, {x = -897.119, y = -708.004, z = 18.884}, {x = -895.285, y = -776.227, z = 14.915}, {x = -881.781, y = -842.654, z = 17.953}, {x = -864.694, y = -859.509, z = 18.030}, {x = -864.667, y = -879.513, z = 16.374}, {x = -865.098, y = -906.373, z = 14.514}, {x = -820.731, y = -931.344, z = 15.514}, {x = -842.217, y = -1045.943, z = 10.583}, {x = -782.437, y = -1054.225, z = 11.982}, {x = -813.492, y = -1077.046, z = 10.135}, {x = -758.688, y = -1094.795, z = 9.715}, {x = -769.721, y = -1064.276, z = 11.983}, {x = -815.303, y = -1106.995, z = 10.137}, {x = -748.283, y = -1125.638, z = 9.625}, {x = -742.570, y = -1113.793, z = 9.798}, {x = -719.377, y = -1070.862, z = 12.054}, {x = -691.122, y = -1050.571, z = 14.686}, {x = -669.626, y = -1007.664, z = 16.940}, {x = -621.864, y = -982.534, z = 20.342}, {x = -557.874, y = -965.583, z = 22.488}, {x = -531.934, y = -921.879, z = 23.448}, {x = -512.356, y = -855.434, z = 29.392}, {x = -342.300, y = -862.988, z = 30.605}, {x = -298.844, y = -870.525, z = 30.713}, {x = -258.731, y = -883.259, z = 29.926}, {x = -243.716, y = -893.356, z = 29.311}, {x = -229.370, y = -898.669, z = 28.816}, {x = -215.486, y = -897.802, z = 28.393}, {x = -196.259, y = -859.471, z = 28.360}, {x = -180.643, y = -917.118, z = 28.302}, {x = -145.989, y = -891.138, z = 28.336}, {x = -72.173, y = -950.546, z = 28.247}, {x = -59.461, y = -956.182, z = 28.369}, {x = -44.920, y = -1025.125, z = 27.741}, {x = -52.780, y = -1065.356, z = 26.554}, {x = -67.743, y = -1088.132, z = 25.749}, {x = -79.092, y = -1119.382, z = 24.805}, {x = -69.031, y = -1127.764, z = 24.781}, {x = -3.615, y = -1124.800, z = 26.906}, {x = 25.450, y = -1123.605, z = 28.247}, {x = 34.957, y = -1117.166, z = 28.291}, {x = 77.542, y = -1112.454, z = 28.291}, {x = 61.002, y = -1069.612, z = 28.452}, {x = 73.094, y = -1042.463, z = 28.445}, {x = 112.194, y = -1026.065, z = 28.359}, {x = 175.404, y = -1008.196, z = 28.334}, {x = 198.589, y = -1021.067, z = 28.474}, {x = 196.536, y = -1046.411, z = 28.275}, {x = 226.770, y = -1080.256, z = 28.300}, {x = 297.166, y = -1071.805, z = 28.408}, {x = 297.228, y = -1098.716, z = 28.402}, {x = 297.172, y = -1117.279, z = 28.416}, {x = 319.739, y = -1124.918, z = 28.429}, {x = 356.141, y = -1124.982, z = 28.411}, {x = 389.624, y = -1118.990, z = 28.460}, {x = 405.197, y = -1090.637, z = 28.406}, {x = 386.124, y = -1078.388, z = 28.424}, {x = 410.389, y = -1032.776, z = 28.408}, {x = 391.209, y = -1025.873, z = 28.320}, {x = 392.451, y = -1002.692, z = 28.419}, {x = 393.176, y = -973.321, z = 28.440}, {x = 415.401, y = -961.615, z = 28.466}, {x = 396.657, y = -940.352, z = 28.418}, {x = 411.142, y = -913.353, z = 28.420}, {x = 398.113, y = -900.325, z = 28.420}, {x = 412.587, y = -883.676, z = 28.433}, {x = 399.679, y = -832.068, z = 28.293}, {x = 399.755, y = -809.733, z = 28.293}, {x = 413.070, y = -782.583, z = 28.300}, {x = 399.593, y = -772.013, z = 28.291}, {x = 412.659, y = -736.245, z = 28.293}, {x = 412.516, y = -716.377, z = 28.300}, {x = 358.922, y = -697.372, z = 28.276}, {x = 337.091, y = -627.431, z = 28.256}, {x = 333.896, y = -678.593, z = 28.322}, {x = 265.680, y = -614.700, z = 41.464}, {x = 273.574, y = -621.643, z = 40.978}, {x = 231.972, y = -597.316, z = 42.826}, {x = 165.402, y = -604.761, z = 42.766}, {x = 207.675, y = -599.337, z = 42.826}, {x = 183.167, y = -594.299, z = 42.293}, {x = 167.110, y = -584.572, z = 42.872}, {x = 138.328, y = -595.045, z = 43.006}, {x = 138.348, y = -577.483, z = 42.941}, {x = 132.135, y = -592.856, z = 42.976}, {x = 76.750, y = -605.367, z = 43.222}, {x = -44.253, y = -562.374, z = 38.654}, {x = -43.195, y = -419.362, z = 38.657}, {x = -3.691, y = -413.025, z = 38.306}, {x = 7.623, y = -375.592, z = 38.738}, {x = 19.991, y = -346.394, z = 41.864}, {x = 48.075, y = -301.946, z = 46.476}, {x = 49.566, y = -268.007, z = 46.589}, {x = 59.721, y = -219.044, z = 51.093}, {x = 57.101, y = -183.526, z = 53.893}, {x = 83.921, y = -184.657, z = 53.963}, {x = 56.101, y = -141.553, z = 54.056}, {x = 13.304, y = -125.402, z = 55.178}, {x = -5.293, y = -111.940, z = 55.785}, {x = 24.565, y = -0.350, z = 69.087}, {x = 39.184, y = 14.567, z = 68.779}, {x = 90.320, y = -23.935, z = 67.168}, {x = 107.928, y = -10.815, z = 66.908}, {x = 141.469, y = -22.744, z = 66.577}, {x = 188.686, y = -40.469, z = 67.439}, {x = 201.026, y = -38.027, z = 67.675}, {x = 215.839, y = -69.445, z = 68.204}, {x = 238.242, y = -51.946, z = 68.526}, {x = 262.983, y = -86.185, z = 69.035}, {x = 254.877, y = -58.480, z = 68.854}, {x = 301.195, y = -77.548, z = 69.189}, {x = 339.319, y = -91.926, z = 66.971}, {x = 368.322, y = -130.784, z = 64.419}, {x = 301.195, y = -77.548, z = 69.189}, {x = 262.983, y = -86.185, z = 69.035}, {x = 254.877, y = -58.480, z = 68.854}, {x = 215.839, y = -69.445, z = 68.204}, {x = 215.459, y = -50.295, z = 68.057}, {x = 188.686, y = -40.469, z = 67.439}, {x = 201.026, y = -38.027, z = 67.675}, {x = 141.469, y = -22.744, z = 66.577}, {x = 107.928, y = -10.815, z = 66.908}, {x = 90.320, y = -23.935, z = 67.168}, {x = 39.184, y = 14.567, z = 68.779}, {x = 24.565, y = -0.350, z = 69.087}, {x = -26.910, y = 18.152, z = 70.834}, {x = -31.116, y = 50.335, z = 71.234}, {x = -50.235, y = 53.588, z = 71.244}, {x = -68.978, y = 78.720, z = 70.618}, {x = -377.709, y = 116.751, z = 64.847}, {x = -404.854, y = 117.139, z = 64.452}, {x = -411.814, y = 94.204, z = 63.327}, {x = -411.836, y = 93.373, z = 63.295}, {x = -439.260, y = 100.031, z = 63.657}, {x = -456.819, y = 118.737, z = 63.413}, {x = -456.355, y = 98.096, z = 62.143}, {x = -521.989, y = 120.264, z = 62.156}, {x = -509.401, y = 86.661, z = 72.724}, {x = -509.369, y = 85.830, z = 72.722}, {x = -678.649, y = 165.653, z = 72.243}, {x = -708.738, y = 2.687, z = 37.010}, {x = -713.221, y = -65.298, z = 36.703}, {x = -755.200, y = -84.596, z = 36.320}, {x = -806.658, y = -97.725, z = 36.566}, {x = -829.815, y = -54.871, z = 36.883}, {x = -869.403, y = -75.290, z = 36.870}, {x = -852.359, y = -121.221, z = 36.688}, {x = -844.888, y = -127.746, z = 36.554}, {x = -799.150, y = -103.440, z = 36.548}, {x = -755.200, y = -84.596, z = 36.320}, {x = -727.948, y = -246.809, z = 36.045}, {x = -893.384, y = -309.165, z = 38.572}, {x = -928.541, y = -281.431, z = 38.558}, {x = -907.048, y = -316.227, z = 38.482}, {x = -955.190, y = -335.347, z = 36.895}, {x = -993.199, y = -327.597, z = 36.854}, {x = -993.541, y = -283.823, z = 37.341}, {x = -978.919, y = -360.895, z = 36.833}, {x = -944.999, y = -411.044, z = 36.651}, {x = -985.831, y = -459.916, z = 36.536}, {x = -963.362, y = -470.109, z = 36.460}, {x = -847.784, y = -612.401, z = 28.025}, {x = -876.654, y = -636.012, z = 27.130}, {x = -852.450, y = -636.692, z = 27.207}, {x = -897.119, y = -708.004, z = 18.884}, {x = -895.285, y = -776.227, z = 14.915}, {x = -881.781, y = -842.654, z = 17.953}, {x = -864.694, y = -859.509, z = 18.030}, {x = -864.667, y = -879.513, z = 16.374}, {x = -865.098, y = -906.373, z = 14.514}, {x = -820.731, y = -931.344, z = 15.514}, {x = -842.217, y = -1045.943, z = 10.583}, {x = -782.437, y = -1054.225, z = 11.982}, {x = -813.492, y = -1077.046, z = 10.135}, {x = -758.688, y = -1094.795, z = 9.715}, {x = -769.721, y = -1064.276, z = 11.983}, {x = -815.303, y = -1106.995, z = 10.137}, {x = -748.283, y = -1125.638, z = 9.625}, {x = -630.849, y = -1283.811, z = 9.765}, {x = -699.064, y = -1318.747, z = 4.103}, {x = -615.558, y = -1252.765, z = 10.634}, {x = -563.437, y = -1249.102, z = 13.086}, {x = -520.519, y = -1117.131, z = 20.929}, {x = -340.594, y = -1123.757, z = 26.181}, {x = -296.655, y = -1152.360, z = 22.091}, {x = -285.499, y = -1122.247, z = 22.013}, {x = -247.914, y = -1128.269, z = 22.040}, {x = -266.282, y = -1065.386, z = 24.695}, {x = -231.210, y = -968.500, z = 28.291}, {x = -238.157, y = -974.037, z = 28.289}, {x = -234.248, y = -962.861, z = 28.289}, {x = -223.178, y = -946.773, z = 28.293}, {x = -180.643, y = -917.118, z = 28.302}, {x = -145.989, y = -891.138, z = 28.336}, {x = -72.173, y = -950.546, z = 28.247}, {x = -59.461, y = -956.182, z = 28.369}, {x = -44.920, y = -1025.125, z = 27.741}, {x = -52.780, y = -1065.356, z = 26.554}, {x = -67.743, y = -1088.132, z = 25.749}, {x = -79.092, y = -1119.382, z = 24.805}, {x = -111.867, y = -1115.201, z = 24.776}, {x = -86.181, y = -1285.931, z = 28.300}, {x = -85.632, y = -1379.321, z = 28.315}, {x = -172.428, y = -1421.269, z = 30.203}, {x = -202.689, y = -1435.671, z = 30.646}, {x = -208.072, y = -1502.922, z = 30.591}, {x = -30.866, y = -1579.877, z = 28.260}, {x = -5.575, y = -1648.865, z = 28.311}, {x = 5.413, y = -1603.232, z = 28.296}, {x = 4.385, y = -1674.541, z = 28.299}, {x = 85.471, y = -1664.396, z = 28.297}, {x = 87.651, y = -1723.161, z = 27.967}, {x = 139.882, y = -1766.928, z = 28.041}, {x = 254.022, y = -1634.980, z = 28.288}, {x = 318.740, y = -1668.188, z = 31.532}, {x = 325.546, y = -1725.464, z = 28.306}, {x = 333.584, y = -1680.606, z = 31.532}, {x = 330.573, y = -1724.254, z = 28.420}, {x = 374.185, y = -1712.016, z = 28.273}, {x = 324.675, y = -1724.723, z = 28.303}, {x = 450.565, y = -1905.007, z = 23.900}, {x = 563.499, y = -1748.335, z = 28.283}, {x = 572.329, y = -1640.331, z = 25.011}, {x = 578.734, y = -1632.672, z = 24.976}, {x = 572.716, y = -1594.426, z = 26.653}, {x = 569.430, y = -1575.988, z = 27.277}, {x = 510.051, y = -1453.213, z = 28.291}, {x = 771.039, y = -1424.470, z = 26.248}, {x = 948.253, y = -1455.762, z = 30.279}, {x = 1106.566, y = -1466.936, z = 33.845}, {x = 1136.139, y = -1467.967, z = 33.845}, {x = 1161.625, y = -1470.559, z = 33.846}, {x = 1230.241, y = -1237.802, z = 34.610}, {x = 1230.577, y = -1237.212, z = 34.606}, {x = 1142.575, y = -984.982, z = 44.992}, {x = 1123.607, y = -965.072, z = 45.943}, {x = 955.703, y = -916.442, z = 41.932}, {x = 759.113, y = -859.321, z = 24.386}, {x = 760.570, y = -887.850, z = 24.099}, {x = 467.865, y = -817.839, z = 25.639}, {x = 399.679, y = -832.068, z = 28.293}, {x = 399.755, y = -809.733, z = 28.293}, {x = 413.070, y = -782.583, z = 28.300}, {x = 399.593, y = -772.013, z = 28.291}, {x = 399.280, y = -739.881, z = 28.278}, {x = 412.659, y = -736.245, z = 28.293}, {x = 412.516, y = -716.377, z = 28.300}, {x = 358.922, y = -697.372, z = 28.276}, {x = 333.896, y = -678.593, z = 28.322}, {x = 337.091, y = -627.431, z = 28.256}, {x = 265.680, y = -614.700, z = 41.464}, {x = 273.574, y = -621.643, z = 40.978}, {x = 231.972, y = -597.316, z = 42.826}, {x = 165.402, y = -604.761, z = 42.766}, {x = 187.404, y = -591.968, z = 42.826}, {x = 183.167, y = -594.299, z = 42.293}, {x = 159.066, y = -585.372, z = 42.974}, {x = 138.328, y = -595.045, z = 43.006}, {x = 132.135, y = -592.856, z = 42.976}, {x = 138.348, y = -577.483, z = 42.941}, {x = 76.750, y = -605.367, z = 43.222}, {x = -44.253, y = -562.374, z = 38.654}, {x = -108.776, y = -587.219, z = 47.242}, {x = -60.328, y = -605.680, z = 35.268}, {x = -108.111, y = -601.018, z = 35.261}, {x = -110.690, y = -592.571, z = 47.242}, {x = -112.146, y = -612.957, z = 35.261}, {x = -119.453, y = -616.496, z = 47.242}, {x = -121.366, y = -621.847, z = 47.242}}
local usedBuckets = {}
local bucketBlips = {}
local truckCapacity = 0
local dutyStatus = false
local dutyVehicle = nil

local function setClothingDuty()
 if(GetEntityModel(GetPlayerPed(-1)) == -1667301416) then -- Female
  TriggerEvent('outfit:set', json.decode('{"clothing":{"drawables":[0,120,4,15,35,0,25,0,36,0,0,118],"palette":[0,0,1,0,0,0,0,0,0,0,0,0],"textures":[0,0,1,0,0,0,0,0,0,0,0,0]},"props":{"textures":[-1,-1,-1,-1,-1,-1,-1,-1],"drawables":[-1,-1,-1,-1,-1,-1,-1,-1]},"model":-1667301416}'))
 else -- Male
  TriggerEvent('outfit:set', json.decode('{"clothing":{"drawables":[0,0,2,2,36,0,24,0,59,0,0,56],"palette":[0,0,0,0,2,0,0,0,0,0,0,0],"textures":[0,0,1,0,0,0,0,0,0,0,0,0]},"props":{"drawables":[-1,-1,-1,-1,-1,-1,-1,-1],"textures":[-1,-1,-1,-1,-1,-1,-1,-1]},"model":1885233650}'))
 end
end

local function spawnDutyVehicle()
 RequestModel(GetHashKey('trash2'))
 while not HasModelLoaded(GetHashKey('trash2')) do
  Citizen.Wait(0)
 end
 dutyVehicle = CreateVehicle(GetHashKey('trash2'), -367.813, -1527.007, 27.770, 173.027, true, false)
 local id = NetworkGetNetworkIdFromEntity(dutyVehicle)
 SetNetworkIdCanMigrate(id, true)
 SetNetworkIdExistsOnAllMachines(id, true)
 SetVehicleDirtLevel(dutyVehicle, 0)
 SetVehicleHasBeenOwnedByPlayer(dutyVehicle, true)
 SetEntityAsMissionEntity(dutyVehicle, true, true)
 truckCapacity = 0
end

Citizen.CreateThread(function()
 while true do
  Citizen.Wait(5)
  if DecorGetInt(GetPlayerPed(-1), "Job") == 10 then
   if(GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), -354.999, -1513.897, 27.717, true) < 25) then
    DrawMarker(25, -354.999, -1513.897, 27.717-0.95, 0, 0, 0, 0, 0, 0, 1.0, 1.0, 1.0, 100, 252, 255, 175, 0, 0, 2, 0, 0, 0, 0)
    if(GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), -354.999, -1513.897, 27.717, true) < 1.1) then
     drawTxt('~b~Pulse ~g~E~b~ Para entra servicio')
     if IsControlJustPressed(0, 38) then
      dutyStatus = not dutyStatus
      if dutyStatus then 
       setClothingDuty()
       spawnDutyVehicle()
       setTrashMission()
      elseif not dutyStatus then
       SetEntityAsMissionEntity(dutyVehicle, false, false)
       DeleteEntity(dutyVehicle)
       ExecuteCommand('clothes')
       for id,v in pairs(usedBuckets) do 
        RemoveBlip(usedBuckets[id].blip)
       end
      end
     end
    end
   elseif(GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), -348.918, -1559.390, 25.229, true) < 25) and IsPedInVehicle(GetPlayerPed(-1), dutyVehicle, false) then
    DrawMarker(25, -348.918, -1559.390, 25.229-0.95, 0, 0, 0, 0, 0, 0, 3.0, 3.0, 3.0, 100, 252, 255, 175, 0, 0, 2, 0, 0, 0, 0)
    if(GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), -348.918, -1559.390, 25.229, true) < 3.0) then
     drawTxt('~b~Pulse ~g~E~b~ Vaciar el camión de basura')
     if IsControlJustPressed(0, 38) then
      TriggerServerEvent('jobs:addmoney', truckCapacity*225)
      truckCapacity = 0
     end
    end
   end
  end
 end
end)

function setTrashMission()
 for id,v in pairs(buckets) do 
  table.insert(usedBuckets, {x = v.x, y = v.y, z = v.z, id = id})
 end
 for id,v in pairs(usedBuckets) do 
   usedBuckets[id].blip = AddBlipForCoord(v.x, v.y, v.z)
   SetBlipSprite(usedBuckets[id].blip, 456)
   SetBlipDisplay(usedBuckets[id].blip, 4)
   SetBlipScale(usedBuckets[id].blip, 0.5)
   SetBlipColour(usedBuckets[id].blip, 3)
   SetBlipAsShortRange(usedBuckets[id].blip, true)
   BeginTextCommandSetBlipName("STRING")
   AddTextComponentString('Trash Can')
   EndTextCommandSetBlipName(usedBuckets[id].blip)
 end
end

Citizen.CreateThread(function()
 while true do
  Citizen.Wait(5)
  if DecorGetInt(GetPlayerPed(-1), "Job") == 10 then
   if dutyStatus then 
    for id,v in pairs(usedBuckets) do 
     if(GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), v.x, v.y, v.z, true) < 25) then
      DrawMarker(2, v.x, v.y, v.z+1.40,0,0,0,0,0,0,0.5,0.5,0.5,25,165,255,165,0,0,0,0)
      if(GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), v.x, v.y, v.z, true) < 1.7) then
       drawTxt('\n~b~Pulse ~g~G~b~ Para recoger la basura')
       if IsControlJustPressed(0, 47) then
        if truckCapacity < 17 then
         RemoveBlip(usedBuckets[id].blip)
         truckCapacity = truckCapacity + 1  
         table.remove(usedBuckets, id)
        else
         exports.pNotify:SendNotification({text = "El camión de basura está lleno, vacíe el camión en el depósito"})
        end
       end
      end
     end
    end
   end
  end
 end
end)
